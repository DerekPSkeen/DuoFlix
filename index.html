<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DuoFlix ‚Ä¢ Watch Together</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
  body { font-family: 'Inter', system-ui; overflow: hidden; background: #09090b; }
  .card { 
    transition: transform 0.08s linear; 
    box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.5); 
    touch-action: none; 
    position: relative; 
    overflow: hidden; 
    border-radius: 24px;
    aspect-ratio: 9 / 14; /* Tinder-style poster ratio */
    max-width: 340px;
    width: 100%;
    max-height: clamp(420px, 68dvh, 620px); /* True adaptive poster size */
  }
  .card img { 
    width: 100%; 
    height: 100%; 
    object-fit: cover; 
  }
  .overlay { 
    position: absolute; 
    inset: 0; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    font-size: 80px; 
    font-weight: 900; 
    opacity: 0; 
    transition: opacity 0.2s; 
    pointer-events: none; 
    text-shadow: 0 0 30px currentColor; 
  }
  .like { color: #22c55e; }
  .nope { color: #ef4444; }
  .gradient-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 45%;
    background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 60%, transparent 100%);
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    padding: 24px 20px 20px;
    color: white;
  }
  /* Safe area for iPhone home indicator + Larger Text */
  .safe-bottom {
    padding-bottom: max(32px, env(safe-area-inset-bottom));
  }
</style>
</head>
<body class="bg-zinc-950 text-white min-h-screen">

<div class="max-w-md mx-auto bg-zinc-900 min-h-screen flex flex-col">

  <!-- Header - Fixed -->
  <div class="p-4 border-b border-zinc-800 flex items-center gap-3 bg-zinc-900 z-10">
    <div class="text-4xl">‚ù§Ô∏è</div>
    <h1 class="text-4xl font-bold tracking-tighter">DuoFlix</h1>
  </div>

  <!-- Tabs - Fixed -->
  <div class="flex border-b border-zinc-800 text-sm bg-zinc-900 z-10">
    <button onclick="showTab(0)" id="tab0" class="flex-1 py-4 font-semibold border-b-4 border-red-500 text-red-500">SWIPE</button>
    <button onclick="showTab(1)" id="tab1" class="flex-1 py-4 font-semibold text-zinc-400">MATCHES (<span id="matchCount">0</span>)</button>
    <button onclick="showTab(2)" id="tab2" class="flex-1 py-4 font-semibold text-zinc-400">PRO</button>
  </div>

  <!-- SWIPE SCREEN - Tinder-Style Full Adaptive Layout -->
  <div id="screen0" class="flex-1 flex flex-col p-5 bg-zinc-900" style="height: calc(100dvh - 140px);">
    <div id="card-container" class="flex-1 flex items-center justify-center relative min-h-0">
      <div id="card" class="card cursor-grab active:cursor-grabbing"></div>
      <div id="like-overlay" class="overlay like">LIKE</div>
      <div id="nope-overlay" class="overlay nope">NOPE</div>
    </div>

    <!-- Buttons - Fixed bottom with safe area -->
    <div class="flex justify-center gap-12 mt-auto safe-bottom">
      <button onclick="swipeLeft()" class="w-20 h-20 bg-zinc-800 rounded-3xl text-6xl flex items-center justify-center active:scale-90 transition-transform">‚ùå</button>
      <button onclick="swipeRight()" class="w-20 h-20 bg-red-600 rounded-3xl text-6xl flex items-center justify-center active:scale-90 transition-transform">‚ù§Ô∏è</button>
    </div>
  </div>

  <!-- MATCHES SCREEN -->
  <div id="screen1" class="p-6 hidden flex-1 overflow-auto">
    <h2 class="text-center mb-6 text-xl font-semibold">Your Matches</h2>
    <div id="match-list" class="grid grid-cols-2 gap-4"></div>
  </div>

  <!-- PRO SCREEN -->
  <div id="screen2" class="p-6 hidden flex-1 text-center">
    <div class="text-6xl mb-6">üîì</div>
    <h2 class="text-3xl font-bold">Go Pro ‚Äî $4.99/mo per couple</h2>
    <p class="text-zinc-400 mt-2">Unlimited swipes ‚Ä¢ Live sync ‚Ä¢ No ads</p>
    <button onclick="upgradeToPro()" class="mt-12 bg-gradient-to-r from-red-500 to-pink-500 w-full py-5 rounded-3xl text-xl font-bold">Upgrade Now</button>
  </div>

</div>

<!-- DETAILS MODAL - Full screen style -->
<div id="details-modal" class="hidden fixed inset-0 bg-black/95 flex items-center justify-center z-50 p-5">
  <div class="bg-zinc-900 rounded-3xl w-full max-w-xs max-h-[90dvh] overflow-hidden flex flex-col">
    <button onclick="closeDetails()" class="absolute top-6 right-6 text-3xl text-white z-10">‚úï</button>
    <div id="modal-poster" class="flex-shrink-0"></div>
    <div class="p-6 flex-1 overflow-auto">
      <p id="modal-title" class="text-3xl font-bold"></p>
      <p id="modal-info" class="text-zinc-400 mt-1"></p>
      <p id="modal-desc" class="text-sm mt-6 leading-relaxed"></p>
      <p id="modal-actors" class="text-sm mt-6 text-zinc-300"></p>
      <p id="modal-providers" class="text-sm mt-6 text-emerald-400 font-medium"></p>
    </div>
  </div>
</div>

<script>
// ====================== TMDB TOKEN ======================
const TMDB_READ_TOKEN = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJlMjA0ZGQzYTU5ZWY2MzY1MzRlOTBlZGE2ZDU4NWJlNCIsIm5iZiI6MTc3MTc3MjIxMy43NTEwMDAyLCJzdWIiOiI2OTliMTkzNWJkN2E3NTBhNDk4MGVkZTciLCJzY29wZXMiOlsiYXBpX3JlYWQiXSwidmVyc2lvbiI6MX0.AkgenA40NIZJ4jfNEGVPnxAQxtE000b7fY3g3EgF5gY';

// Global variables
let shows = [];
let currentIndex = 0;
let lastSwiped = null;
let matches = JSON.parse(localStorage.getItem('duoflixMatches')) || [];
let yourLikes = [];
let partnerLikes = [];

// Load trending shows from TMDB (real data)
async function loadRealShows() {
  try {
    const res = await fetch('https://api.themoviedb.org/3/trending/all/week?language=en-US', {
      headers: { 'Authorization': `Bearer ${TMDB_READ_TOKEN}` }
    });
    const data = await res.json();
    shows = data.results.map(item => ({
      id: item.id,
      title: item.title || item.name || "Unknown Title",
      year: (item.release_date || item.first_air_date || "2024").slice(0,4),
      rating: item.vote_average ? item.vote_average.toFixed(1) : "8.5",
      genre: "Trending",
      img: `https://image.tmdb.org/t/p/w500${item.poster_path}`,
      desc: (item.overview || "A great watch for couples!").slice(0, 140) + "...",
      providers: ["Netflix", "Max", "Hulu"],
      actors: getActors(item.title || item.name)
    }));
    currentIndex = 0;
    showCard();
  } catch (e) {
    console.log("TMDB fallback used");
    // Fallback cards for demo
    shows = [
      {id:1,title:"Dune: Part Two",year:"2024",rating:"8.9",img:"https://picsum.photos/id/1015/600/900",desc:"Epic sci-fi masterpiece...",providers:["Netflix","Max"],actors:["Timoth√©e Chalamet","Zendaya"]},
      {id:2,title:"House of the Dragon",year:"2024",rating:"8.5",img:"https://picsum.photos/id/201/600/900",desc:"Game of Thrones prequel...",providers:["Hulu","Max"],actors:["Matt Smith","Emma D'Arcy"]}
    ];
    showCard();
  }
}

function getActors(title) {
  const map = {
    "Dune": ["Timoth√©e Chalamet", "Zendaya", "Rebecca Ferguson"],
    "Oppenheimer": ["Cillian Murphy", "Emily Blunt"],
    "House of the Dragon": ["Matt Smith", "Emma D'Arcy"],
    "Barbie": ["Margot Robbie", "Ryan Gosling"]
  };
  for (let key in map) if (title.includes(key)) return map[key];
  return ["Timoth√©e Chalamet", "Zendaya"];
}

// Render the Tinder-style card with gradient overlay
function showCard() {
  const show = shows[currentIndex] || shows[0];
  const cardHTML = `
    <img src="${show.img}" alt="${show.title}" class="w-full h-full object-cover">
    <!-- Gradient Overlay - Title + Year + Details (Tinder style) -->
    <div class="gradient-overlay">
      <h2 class="text-3xl font-bold leading-none">${show.title}</h2>
      <p class="text-lg text-white/90 mt-1">${show.year} ‚Ä¢ ${show.rating}</p>
      <button onclick="showDetails(); event.stopImmediatePropagation();" 
              class="mt-6 w-full bg-white text-black py-3.5 rounded-2xl text-sm font-semibold shadow-lg active:scale-95 transition">
        Details
      </button>
    </div>
  `;
  document.getElementById('card').innerHTML = cardHTML;
}

// Show full details in modal
function showDetails() {
  const show = shows[currentIndex];
  document.getElementById('modal-poster').innerHTML = `<img src="${show.img}" class="w-full h-auto object-cover">`;
  document.getElementById('modal-title').textContent = show.title;
  document.getElementById('modal-info').innerHTML = `${show.year} ‚Ä¢ Trending ‚Ä¢ ${show.rating}`;
  document.getElementById('modal-desc').textContent = show.desc;
  document.getElementById('modal-actors').innerHTML = `Cast: ${show.actors.join(", ")}`;
  document.getElementById('modal-providers').innerHTML = `Available on: ${show.providers.join(", ")}`;
  document.getElementById('details-modal').classList.remove('hidden');
}

function closeDetails() {
  document.getElementById('details-modal').classList.add('hidden');
}

// Advanced Drag Swipe with velocity (premium Tinder feel)
const cardEl = document.getElementById('card');
let isDragging = false;
let startX = 0;
let currentX = 0;
let velocity = 0;
let lastTime = 0;

cardEl.addEventListener('pointerdown', e => {
  isDragging = true;
  startX = e.clientX;
  currentX = 0;
  velocity = 0;
  lastTime = Date.now();
  cardEl.style.transition = 'none';
});

document.addEventListener('pointermove', e => {
  if (!isDragging) return;
  currentX = e.clientX - startX;
  const now = Date.now();
  velocity = (currentX - (cardEl._lastX || 0)) / (now - lastTime + 1);
  cardEl._lastX = currentX;
  lastTime = now;

  const progress = Math.min(Math.abs(currentX) / 140, 1);
  cardEl.style.transform = `translateX(${currentX}px) rotate(${currentX / 20}deg) scale(${1 - progress * 0.05})`;

  const likeO = document.getElementById('like-overlay');
  const nopeO = document.getElementById('nope-overlay');
  if (currentX > 0) {
    likeO.style.opacity = progress;
    nopeO.style.opacity = 0;
  } else {
    nopeO.style.opacity = progress;
    likeO.style.opacity = 0;
  }

  if (Math.abs(currentX) > 160) {
    isDragging = false;
    const direction = currentX > 0 ? 1 : -1;
    cardEl.style.transition = 'transform 0.35s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
    cardEl.style.transform = `translateX(${direction * 650}px) rotate(${direction * 45}deg) scale(0.7)`;
    setTimeout(() => nextCard(direction > 0), 280);
  }
});

document.addEventListener('pointerup', e => {
  if (!isDragging) return;
  isDragging = false;

  cardEl.style.transition = 'transform 0.4s cubic-bezier(0.25, 0.1, 0.25, 1)';
  if (Math.abs(currentX) > 100 || Math.abs(velocity) > 1.2) {
    const direction = currentX > 0 || velocity > 0 ? 1 : -1;
    cardEl.style.transform = `translateX(${direction * 650}px) rotate(${direction * 45}deg) scale(0.7)`;
    setTimeout(() => nextCard(direction > 0), 280);
  } else {
    cardEl.style.transform = 'translateX(0) rotate(0deg) scale(1)';
    document.getElementById('like-overlay').style.opacity = 0;
    document.getElementById('nope-overlay').style.opacity = 0;
  }
});

function nextCard(isLike) {
  lastSwiped = shows[currentIndex];
  if (isLike) {
    yourLikes.push(shows[currentIndex]);
    if (partnerLikes.some(s => s.id === shows[currentIndex].id)) {
      createMatch(shows[currentIndex]);
    }
  }
  currentIndex = (currentIndex + 1) % shows.length;
  showCard();
  cardEl.style.transition = 'none';
  cardEl.style.transform = 'translateX(0) rotate(0deg) scale(1)';
  document.getElementById('like-overlay').style.opacity = 0;
  document.getElementById('nope-overlay').style.opacity = 0;
}

function swipeLeft() { nextCard(false); }
function swipeRight() { nextCard(true); }

function undoSwipe() {
  if (!lastSwiped) return alert("Nothing to undo");
  currentIndex = shows.findIndex(s => s.id === lastSwiped.id);
  if (currentIndex === -1) currentIndex = 0;
  showCard();
  lastSwiped = null;
}

function createMatch(show) {
  if (matches.some(m => m.id === show.id)) return;
  matches.push(show);
  localStorage.setItem('duoflixMatches', JSON.stringify(matches));
  // Simple match animation (can be expanded)
  alert(`üéâ It's a MATCH! ${show.title}`);
  renderMatches();
}

function renderMatches() {
  const container = document.getElementById('match-list');
  container.innerHTML = matches.map(m => `
    <div class="bg-zinc-800 rounded-2xl overflow-hidden">
      <img src="${m.img}" class="w-full aspect-square object-cover">
      <p class="p-3 text-center font-medium">${m.title}</p>
    </div>
  `).join('');
}

function showTab(n) {
  document.getElementById('screen0').style.display = n === 0 ? 'flex' : 'none';
  document.getElementById('screen1').style.display = n === 1 ? 'block' : 'none';
  document.getElementById('screen2').style.display = n === 2 ? 'block' : 'none';
  if (n === 1) renderMatches();
}

function upgradeToPro() {
  alert("DuoFlix Pro activated!\nUnlimited swipes + real-time partner sync unlocked ‚ù§Ô∏è");
}

// Keyboard support (for laptop testing)
document.addEventListener('keydown', e => {
  if (e.key === "ArrowLeft") swipeLeft();
  if (e.key === "ArrowRight") swipeRight();
  if (e.key.toLowerCase() === "u") undoSwipe();
});

// Resize listener for perfect adaptability
window.addEventListener('resize', () => {
  // Dynamic re-render if needed (rare but included for master level)
  if (document.getElementById('screen0').style.display !== 'none') showCard();
});

// Initialize
loadRealShows();
</script>
</body>
</html>
